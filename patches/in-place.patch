diff -ur ./ang/crmMailing/BodyHtml.html /var/www/citybibleforum/sites/all/modules/civicrm/ang/crmMailing/BodyHtml.html
--- ./ang/crmMailing/BodyHtml.html	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/ang/crmMailing/BodyHtml.html	2016-04-24 15:53:46.386451548 +1000
@@ -14,7 +14,6 @@
         crm-ui-insert-rx="insert:body_html"
         ng-model="mailing.body_html"
         ng-blur="checkTokens(mailing, 'body_html', 'insert:body_html')"
-        class="crm-wysiwyg-fullpage"
         ></textarea>
       <span ng-model="body_html_tokens" crm-ui-validate="hasAllTokens(mailing, 'body_html')"></span>
       <div ng-show="htmlForm.$error.crmUiValidate" class="crmMailing-error-link">
diff -ur ./ang/crmMailing/EditMailingCtrl/2step.html /var/www/citybibleforum/sites/all/modules/civicrm/ang/crmMailing/EditMailingCtrl/2step.html
--- ./ang/crmMailing/EditMailingCtrl/2step.html	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/ang/crmMailing/EditMailingCtrl/2step.html	2016-04-24 15:53:46.394451587 +1000
@@ -21,9 +21,9 @@
             </div>
             <span ng-model="placeholder" crm-ui-validate="mailing.body_html || mailing.body_text"></span>
           </div>
-          <div crm-ui-tab id="tab-attachment" crm-title="ts('Attachments')">
+          <!-- div crm-ui-tab id="tab-attachment" crm-title="ts('Attachments')">
             <div crm-attachments="attachments"/>
-          </div>
+          </div -->
           <div crm-ui-tab id="tab-header" crm-title="ts('Header and Footer')">
             <div crm-mailing-block-header-footer crm-mailing="mailing"/>
           </div>
diff -ur ./api/v3/Generic/Setvalue.php /var/www/citybibleforum/sites/all/modules/civicrm/api/v3/Generic/Setvalue.php
--- ./api/v3/Generic/Setvalue.php	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/api/v3/Generic/Setvalue.php	2016-04-24 15:53:45.730448295 +1000
@@ -106,6 +106,7 @@
       break;
 
     case CRM_Utils_Type::T_DATE:
+    case CRM_Utils_Type::T_DATE + CRM_Utils_Type::T_TIME:
       $value = CRM_Utils_Type::escape($value, "Date", FALSE);
       if (!$value) {
         return civicrm_api3_create_error("Param '$field' is not a date. format YYYYMMDD or YYYYMMDDHHMMSS");
diff -ur ./CRM/Contact/Page/AJAX.php /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Contact/Page/AJAX.php
--- ./CRM/Contact/Page/AJAX.php	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Contact/Page/AJAX.php	2016-04-24 15:53:43.166435581 +1000
@@ -254,7 +254,7 @@
       ));
       // Save activity only for the primary (first) client
       if ($i == 0 && empty($result['is_error'])) {
-        CRM_Case_BAO_Case::createCaseRoleActivity($caseID, $result['id'], $relContactID);
+        CRM_Case_BAO_Case::createCaseRoleActivity($caseID, $result['id'], $relContactID, $sourceContactID);
       }
     }
 
diff -ur ./CRM/Contribute/xml/Menu/Contribute.xml /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Contribute/xml/Menu/Contribute.xml
--- ./CRM/Contribute/xml/Menu/Contribute.xml	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Contribute/xml/Menu/Contribute.xml	2016-04-24 15:53:43.034434926 +1000
@@ -229,6 +229,8 @@
     <title>Cancel Subscription</title>
     <page_callback>CRM_Contribute_Form_CancelSubscription</page_callback>
     <access_arguments>make online contributions</access_arguments>
+    <is_ssl>true</is_ssl>
+    <is_public>true</is_public>
   </item>
   <item>
     <path>civicrm/contribute/onbehalf</path>
@@ -246,6 +248,8 @@
     <title>Update Subscription</title>
     <page_callback>CRM_Contribute_Form_UpdateSubscription</page_callback>
     <access_arguments>make online contributions</access_arguments>
+    <is_ssl>true</is_ssl>
+    <is_public>true</is_public>
   </item>
   <item>
     <path>civicrm/contribute/subscriptionstatus</path>
diff -ur ./CRM/Core/xml/Menu/Admin.xml /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Core/xml/Menu/Admin.xml
--- ./CRM/Core/xml/Menu/Admin.xml	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Core/xml/Menu/Admin.xml	2016-04-24 15:53:44.590442642 +1000
@@ -741,7 +741,7 @@
      <path>civicrm/sms/send</path>
      <title>New Mass SMS</title>
      <page_callback>CRM_SMS_Controller_Send</page_callback>
-     <access_arguments>administer CiviCRM</access_arguments>
+     <access_arguments>access CiviMail</access_arguments>
      <page_type>1</page_type>
      <weight>610</weight>
   </item>
diff -ur ./CRM/Export/BAO/Export.php /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Export/BAO/Export.php
--- ./CRM/Export/BAO/Export.php	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Export/BAO/Export.php	2016-04-25 00:02:03.107726144 +1000
@@ -764,7 +764,7 @@
     $limitReached = FALSE;
     while (!$limitReached) {
       $limitQuery = "{$queryString} LIMIT {$offset}, {$rowCount}";
-      $dao = CRM_Core_DAO::executeUnbufferedQuery($limitQuery);
+      $dao = CRM_Core_DAO::executeQuery($limitQuery);
       // If this is less than our limit by the end of the iteration we do not need to run the query again to
       // check if some remain.
       $rowsThisIteration = 0;
diff -ur ./CRM/Mailing/Info.php /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Mailing/Info.php
--- ./CRM/Mailing/Info.php	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Mailing/Info.php	2016-04-24 15:53:45.122445280 +1000
@@ -121,7 +121,7 @@
       'return' => array('id', 'name', 'scheduled_date'),
       'sequential' => 1,
       'options' => array(
-        'limit' => 500,
+        'limit' => 50,
         'sort' => 'is_archived asc, scheduled_date desc',
       ),
     ));
diff -ur ./CRM/Utils/DeprecatedUtils.php /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Utils/DeprecatedUtils.php
--- ./CRM/Utils/DeprecatedUtils.php	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/CRM/Utils/DeprecatedUtils.php	2016-04-25 11:05:15.531230308 +1000
@@ -523,7 +523,7 @@
             }
           }
           else {
-            return civicrm_api3_create_error('No match found for specified contact in contribution data. Row was skipped.', 'pledge_payment');
+            return civicrm_api3_create_error('Contribution not found. Row was skipped.');
           }
         }
         else {
@@ -539,7 +539,7 @@
               $contributionContactID = $params['contribution_contact_id'] = $values['contribution_contact_id'] = $contact->id;
             }
             else {
-              return civicrm_api3_create_error('No match found for specified contact in contribution data. Row was skipped.', 'pledge_payment');
+              return civicrm_api3_create_error('Contact not found. Row was skipped.');
             }
           }
           else {
@@ -551,21 +551,21 @@
 
               // check if only one contact is found
               if (count($matchedIDs) > 1) {
-                return civicrm_api3_create_error($error['error_message']['message'], 'pledge_payment');
+                return civicrm_api3_create_error($error['error_message']['message']);
               }
               else {
                 $contributionContactID = $params['contribution_contact_id'] = $values['contribution_contact_id'] = $matchedIDs[0];
               }
             }
             else {
-              return civicrm_api3_create_error('No match found for specified contact in contribution data. Row was skipped.', 'pledge_payment');
+              return civicrm_api3_create_error('No match found for specified contact in contribution data. Row was skipped.');
             }
           }
         }
 
         if (!empty($params['pledge_id'])) {
           if (CRM_Core_DAO::getFieldValue('CRM_Pledge_DAO_Pledge', $params['pledge_id'], 'contact_id') != $contributionContactID) {
-            return civicrm_api3_create_error('Invalid Pledge ID provided. Contribution row was skipped.', 'pledge_payment');
+            return civicrm_api3_create_error('Invalid Pledge ID provided. Contribution row was skipped.');
           }
           $values['pledge_id'] = $params['pledge_id'];
         }
@@ -575,10 +575,10 @@
           $pledgeDetails = CRM_Pledge_BAO_Pledge::getContactPledges($contributionContactID);
 
           if (empty($pledgeDetails)) {
-            return civicrm_api3_create_error('No open pledges found for this contact. Contribution row was skipped.', 'pledge_payment');
+            return civicrm_api3_create_error('No open pledges found for this contact. Contribution row was skipped.');
           }
           elseif (count($pledgeDetails) > 1) {
-            return civicrm_api3_create_error('This contact has more than one open pledge. Unable to determine which pledge to apply the contribution to. Contribution row was skipped.', 'pledge_payment');
+            return civicrm_api3_create_error('This contact has more than one open pledge. Unable to determine which pledge to apply the contribution to. Contribution row was skipped.');
           }
 
           // this mean we have only one pending / in progress pledge
@@ -593,7 +593,7 @@
           $values['pledge_payment_id'] = $pledgePaymentDetails['id'];
         }
         else {
-          return civicrm_api3_create_error('Contribution and Pledge Payment amount mismatch for this record. Contribution row was skipped.', 'pledge_payment');
+          return civicrm_api3_create_error('Contribution and Pledge Payment amount mismatch for this record. Contribution row was skipped.');
         }
         break;
 
diff -ur ./css/civicrm.css /var/www/citybibleforum/sites/all/modules/civicrm/css/civicrm.css
--- ./css/civicrm.css	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/css/civicrm.css	2016-04-24 15:53:42.342431495 +1000
@@ -241,6 +241,14 @@
   height: 5px;
 }
 
+/* 
+ * A fix to prevent the CBF theme making input fields 90% of the form width
+ */
+#crm-container form input.form-text, 
+#crm-container form textarea.form-textarea {
+    width: auto;
+}
+
 .crm-container td.compressed select,
 .crm-container td.compressed input {
   font-size: 0.90em;
@@ -1481,6 +1489,7 @@
 }
 .crm-container a.action-item {
   display: inline;
+  padding: 2px;
 }
 
 /* theming for panel and context menus */
@@ -3167,6 +3176,10 @@
 #crm-container .crm-fb-tweet-buttons {
   width: 93%;
 }
+#crm-container .crm-fb-tweet-buttons .label {
+  width:  64px;
+  height: 30px;
+}
 
 /* classes related to batch entry operation */
 .crm-container span.batch-edit,
@@ -3261,7 +3274,7 @@
 
 /* in place edit  */
 .crm-container .crm-editable-enabled {
-  white-space: nowrap;
+  white-space: normal;
   padding-left: 2px;
   border: 2px dashed transparent;
 }
@@ -3569,6 +3582,7 @@
 #crm-container.crm-public .crm-section,
 .crm-section {
   margin-bottom: 0;
+  clear: left; /* Ensure form elements clear left */
 }
 
 #crm-container.crm-public #crm-submit-buttons {
diff -ur ./js/wysiwyg/crm.ckeditor.js /var/www/citybibleforum/sites/all/modules/civicrm/js/wysiwyg/crm.ckeditor.js
--- ./js/wysiwyg/crm.ckeditor.js	2016-04-08 06:29:23.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/js/wysiwyg/crm.ckeditor.js	2016-04-24 15:53:46.662452916 +1000
@@ -71,12 +71,17 @@
       var isFullPage = $(item).hasClass('crm-wysiwyg-fullpage');
 
       CKEDITOR.replace($(item)[0], {
-        filebrowserBrowseUrl: browseUrl + '&type=files',
-        filebrowserImageBrowseUrl: browseUrl + '&type=images',
-        filebrowserFlashBrowseUrl: browseUrl + '&type=flash',
-        filebrowserUploadUrl: uploadUrl + '&type=files',
-        filebrowserImageUploadUrl: uploadUrl + '&type=images',
-        filebrowserFlashUploadUrl: uploadUrl + '&type=flash',
+        filebrowserBrowseUrl      : '/imce?app=ckeditor|sendto%40ckeditor_imceSendTo|',
+        filebrowserImageBrowseUrl : '/imce?app=ckeditor|sendto%40ckeditor_imceSendTo|',
+        filebrowserFlashBrowseUrl : '/imce?app=ckeditor|sendto%40ckeditor_imceSendTo|',
+        filebrowserUploadUrl      : '',
+        filebrowserImageUploadUrl : '',
+        filebrowserFlashUploadUrl : '',
+        bodyClass                 : 'cke_editable',
+    	contentsCss               : '/sites/all/themes/cbootf/css/editor.css',
+        scayt_autoStartup         : true,
+        scayt_sLang               : 'en_GB',
+        forcePasteAsPlainText     : true,
         allowedContent: true, // For CiviMail!
         fullPage: isFullPage,
         customConfig: CRM.config.CKEditorCustomConfig,
@@ -157,3 +162,20 @@
   };
 
 })(CRM.$, CRM._);
+
+/**
+ * IMCE support
+ * Copied from ckeditor.utils.js
+ */
+var ckeditor_imceSendTo = function (file, win){
+  var cfunc = win.location.href.split('&');
+
+  for (var x in cfunc) {
+    if (cfunc[x].match(/^CKEditorFuncNum=\d+$/)) {
+      cfunc = cfunc[x].split('=');
+      break;
+    }
+  }
+  CKEDITOR.tools.callFunction(cfunc[1], file.url);
+  win.close();
+};
diff -ur ./packages/HTML/QuickForm/Rule/Email.php /var/www/citybibleforum/sites/all/modules/civicrm/packages/HTML/QuickForm/Rule/Email.php
--- ./packages/HTML/QuickForm/Rule/Email.php	2016-04-08 06:29:26.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/packages/HTML/QuickForm/Rule/Email.php	2016-04-24 15:53:40.678423243 +1000
@@ -69,10 +69,12 @@
                 if (checkdnsrr($tokens[1], 'MX') || checkdnsrr($tokens[1], 'A')) {
                     return true;
                 }
+                CRM_Core_Error::debug_log_message("Email address $email failed to pass the DNS check");
                 return false;
             }
             return true;
         }
+        CRM_Core_Error::debug_log_message("Email address $email failed to match the regex pattern");
         return false;
     } // end func validate
 
diff -ur ./packages/Net/SMTP.php /var/www/citybibleforum/sites/all/modules/civicrm/packages/Net/SMTP.php
--- ./packages/Net/SMTP.php	2016-04-08 06:29:26.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/packages/Net/SMTP.php	2016-04-24 15:53:41.782428718 +1000
@@ -184,7 +184,7 @@
         $this->pipelining = $pipelining;
 
         $this->_socket = new Net_Socket();
-        $this->_socket_options = $socket_options;
+        $this->_socket_options = array_merge((array) $socket_options, array('ssl' => array('verify_peer_name' => false)));
         $this->_timeout = $timeout;
 
         /* Include the Auth_SASL package.  If the package is available, we 
diff -ur ./packages/Smarty/internals/core.create_dir_structure.php /var/www/citybibleforum/sites/all/modules/civicrm/packages/Smarty/internals/core.create_dir_structure.php
--- ./packages/Smarty/internals/core.create_dir_structure.php	2016-04-08 06:29:26.000000000 +1000
+++ /var/www/citybibleforum/sites/all/modules/civicrm/packages/Smarty/internals/core.create_dir_structure.php	2016-04-24 15:53:41.666428142 +1000
@@ -65,7 +65,7 @@
                 $_make_new_dir = true;
             }
 
-            if ($_make_new_dir && !file_exists($_new_dir) && !@mkdir($_new_dir, $smarty->_dir_perms) && !is_dir($_new_dir)) {
+            if ($_make_new_dir && !file_exists($_new_dir) && (!@mkdir($_new_dir) || !@chmod($_new_dir, 0770)) && !is_dir($_new_dir)) {
                 $smarty->trigger_error("problem creating directory '" . $_new_dir . "'");
                 return false;
             }
